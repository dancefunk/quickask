(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{585:function(s,e,a){"use strict";a.r(e);var n=a(5),r=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"使用-acme-sh-给-nginx-安装-let-s-encrypt-提供的免费-ssl-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-acme-sh-给-nginx-安装-let-s-encrypt-提供的免费-ssl-证书"}},[s._v("#")]),s._v(" 使用 acme.sh 给 Nginx 安装 Let’ s Encrypt 提供的免费 SSL 证书")]),s._v(" "),a("h2",{attrs:{id:"安装-acme-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-acme-sh"}},[s._v("#")]),s._v(" 安装 acme.sh")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl https://get.acme.sh | sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"然后重新载入一下-bashrc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#然后重新载入一下-bashrc"}},[s._v("#")]),s._v(" 然后重新载入一下 .bashrc")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("source ~/.bashrc \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"申请签发-ssl-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#申请签发-ssl-证书"}},[s._v("#")]),s._v(" 申请签发 SSL 证书")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("acme.sh --issue -d www.your-app.com -w /home/ubuntu/www/your-app/current/public\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("NOTE! 上面这段过程将会往 "),a("strong",[s._v("/home/ubuntu/www/your-app/current/public")]),s._v(" 创建一个 "),a("strong",[s._v(".well-known")]),s._v(" 的文件夹，同时 "),a("strong",[s._v("Let’ s Encrypt")]),s._v(" 将会通过你要注册的域名去访问那个文件来确定权限，它可能会去访问 "),a("strong",[s._v("http://www.your-app.com/.well-known/")]),s._v(" 这个路径。 所以你需要确保 "),a("strong",[s._v("/home/ubuntu/www/your-app/current/public")]),s._v(" 是在 Nginx 上配置成 root 目录，里面任意文件可以直接域名访问的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location ~ /\\.\n{\n\tdeny all;\n}\n\n将虚拟主机里面的上面这段配置删掉或注释掉或在这段配置前面加上下面的配置：\n\nlocation ~ /.well-known {\nallow all;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("如果成功的话，你就会看到这样的结果:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Fri Dec 23 11:20:15 CST 2016] Renew: 'www.your-app.com'\n[Fri Dec 23 11:20:15 CST 2016] Single domain='www.your-app.com'\n[Fri Dec 23 11:20:15 CST 2016] Getting domain auth token for each domain\n[Fri Dec 23 11:20:15 CST 2016] Getting webroot for domain='www.your-app.com'\n[Fri Dec 23 11:20:15 CST 2016] _w='/home/ubuntu/www/your-app/current/public/'\n[Fri Dec 23 11:20:15 CST 2016] Getting new-authz for domain='www.your-app.com'\n[Fri Dec 23 11:08:57 CST 2016] The new-authz request is ok.\n[Fri Dec 23 11:08:57 CST 2016] Verifying:www.your-app.com\n[Fri Dec 23 11:09:01 CST 2016] Success\n[Fri Dec 23 11:09:01 CST 2016] Verify finished, start to sign.\n[Fri Dec 23 11:09:02 CST 2016] Cert success.\n-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----\n[Fri Dec 23 11:09:02 CST 2016] Your cert is in  /home/ubuntu/.acme.sh/www.your-app.com/www.your-app.com.cer \n[Fri Dec 23 11:09:02 CST 2016] Your cert key is in  /home/ubuntu/.acme.sh/www.your-app.com/www.your-app.com.key \n[Fri Dec 23 11:09:04 CST 2016] The intermediate CA cert is in  /home/ubuntu/.acme.sh/www.your-app.com/ca.cer \n[Fri Dec 23 11:09:04 CST 2016] And the full chain certs is there:  /home/ubuntu/.acme.sh/www.your-app.com/fullchain.cer \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("你的证书文件已经申请成功了，并放到了 "),a("strong",[s._v("~/.acme.sh/")]),s._v(" 目录里面。")]),s._v(" "),a("h2",{attrs:{id:"将-ssl-证书安装到网站的路径-并配置好-restart-nginx-的动作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-ssl-证书安装到网站的路径-并配置好-restart-nginx-的动作"}},[s._v("#")]),s._v(" 将 SSL 证书安装到网站的路径，并配置好 restart Nginx 的动作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('acme.sh --installcert -d www.your-app.com \\\n--keypath       /home/ubuntu/www/ssl/www.your-app.com.key  \\\n--fullchainpath /home/ubuntu/www/ssl/www.your-app.com.key.pem \\\n--reloadcmd     "sudo service nginx reload"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("然后你会看到结果")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Fri Dec 23 11:59:57 CST 2016] Installing key to:/home/ubuntu/www/ssl/www.your-app.com.key\n[Fri Dec 23 11:59:57 CST 2016] Installing full chain to:/home/ubuntu/www/ssl/www.your-app.com.key.pem\n[Fri Dec 23 11:59:57 CST 2016] Run Le_ReloadCmd: sudo service nginx force-reload\nRestarting nginx: nginx.\n[Fri Dec 23 11:59:58 CST 2016] Reload success\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"修改一下-sudoer-文件-让-sudo-service-nginx-force-reload-不需要输入密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改一下-sudoer-文件-让-sudo-service-nginx-force-reload-不需要输入密码"}},[s._v("#")]),s._v(" 修改一下 sudoer 文件，让 sudo service nginx force-reload 不需要输入密码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo visudo\n\nubuntu  ALL=(ALL) NOPASSWD: /usr/sbin/service nginx force-reload\n\nubuntu 是 acme.sh 安装所用的账号\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"生成-dhparam-pem-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成-dhparam-pem-文件"}},[s._v("#")]),s._v(" 生成 dhparam.pem 文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("openssl dhparam -out /home/ubuntu/www/ssl/dhparam.pem 2048\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"修改-nginx-或虚拟主机-启用-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-nginx-或虚拟主机-启用-ssl"}},[s._v("#")]),s._v(" 修改 Nginx/或虚拟主机 启用 SSL")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http {\n  # 新增\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n  ssl_prefer_server_ciphers on;\n  # 兼容其他老浏览器的 ssl_ciphers 设置请访问 https://wiki.mozilla.org/Security/Server_Side_TLS\n\n  server {\n    listen 80 default_server;\n    # 新增\n    listen 443 ssl;\n    ssl_certificate         /home/ubuntu/www/ssl/www.your-app.com.key.pem;\n    ssl_certificate_key     /home/ubuntu/www/ssl/www.your-app.com.key;\n    # ssl_dhparam \n    ssl_dhparam             /home/ubuntu/www/ssl/dhparam.pem;\n\n    # 其他省略\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("检查 Nginx 配置是否正确后重启")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo service nginx configtest\nsudo service nginx restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"验证-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证-ssl"}},[s._v("#")]),s._v(" 验证 SSL")]),s._v(" "),a("p",[s._v("访问 ssllabs.com 输入你的域名，检查 SSL 的配置是否都正常：")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.ssllabs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.ssllabs.com/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("确保验证结果有 A 以上，否则根据提示调整问题")]),s._v(" "),a("h2",{attrs:{id:"后续维护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后续维护"}},[s._v("#")]),s._v(" 后续维护")]),s._v(" "),a("p",[s._v("Let's Encrypt 的证书有效期是 90 天的，你需要定期 "),a("strong",[s._v("renew")]),s._v(" 重新申请，这部分 "),a("strong",[s._v("acme.sh")]),s._v(" 以及帮你做了，在安装的时候往 crontab 增加了一行每天执行的命令 "),a("strong",[s._v("acme.sh --cron")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ crontab -l\n0 0 * * * "/home/ubuntu/.acme.sh"/acme.sh --cron --home "/home/ubuntu/.acme.sh" > /dev/null\n\n下面这段你可以尝试执行一下，看看是否正确\n"/home/ubuntu/.acme.sh"/acme.sh --cron --home "/home/ubuntu/.acme.sh"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("这样就是正常的:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Fri Dec 23 11:50:30 CST 2016] Renew: 'www.your-app.com'\n[Fri Dec 23 11:50:30 CST 2016] Skip, Next renewal time is: Tue Feb 21 03:20:54 UTC 2017\n[Fri Dec 23 11:50:30 CST 2016] Add '--force' to force to renew.\n[Fri Dec 23 11:50:30 CST 2016] Skipped www.your-app.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("acme.sh --cron")]),s._v(" 命令执行以后将会 申请新的证书 并放到相同的文件路径。由于前面执行 "),a("strong",[s._v("--installcert")]),s._v(" 的时候告知了重新 Nginx 的方法，"),a("strong",[s._v("acme.sh")]),s._v(" 也同时会在证书更新以后重启 Nginx。")]),s._v(" "),a("h2",{attrs:{id:"最后走一下-acme-sh-cron-的流程看看能否正确执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后走一下-acme-sh-cron-的流程看看能否正确执行"}},[s._v("#")]),s._v(" 最后走一下 acme.sh --cron 的流程看看能否正确执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("acme.sh --cron -f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这个过程应该会得到这样的结果，并在最后重启 Nginx (不需要输入密码)")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Tue Dec 27 14:28:09 CST 2016] Renew: 'www.your-app.com'\n[Tue Dec 27 14:28:09 CST 2016] Single domain='www.your-app.com'\n[Tue Dec 27 14:28:09 CST 2016] Getting domain auth token for each domain\n[Tue Dec 27 14:28:09 CST 2016] Getting webroot for domain='www.your-app.com'\n[Tue Dec 27 14:28:09 CST 2016] _w='/home/ubuntu/www/your-app/current/public/'\n[Tue Dec 27 14:28:09 CST 2016] Getting new-authz for domain='www.your-app.com'\n[Tue Dec 27 14:28:16 CST 2016] The new-authz request is ok.\n[Tue Dec 27 14:28:16 CST 2016] www.your-app.com is already verified, skip.\n[Tue Dec 27 14:28:16 CST 2016] www.your-app.com is already verified, skip http-01.\n[Tue Dec 27 14:28:16 CST 2016] www.your-app.com is already verified, skip http-01.\n[Tue Dec 27 14:28:16 CST 2016] Verify finished, start to sign.\n[Tue Dec 27 14:28:19 CST 2016] Cert success.\n... 省略\n[Fri Dec 23 11:09:02 CST 2016] Your cert is in  /home/ubuntu/.acme.sh/www.your-app.com/www.your-app.com.cer \n[Fri Dec 23 11:09:02 CST 2016] Your cert key is in  /home/ubuntu/.acme.sh/www.your-app.com/www.your-app.com.key \n[Fri Dec 23 11:09:04 CST 2016] The intermediate CA cert is in  /home/ubuntu/.acme.sh/www.your-app.com/ca.cer \n[Fri Dec 23 11:09:04 CST 2016] And the full chain certs is there:  /home/ubuntu/.acme.sh/www.your-app.com/fullchain.cer \n[Tue Dec 27 14:28:22 CST 2016] Run Le_ReloadCmd: sudo service nginx force-reload\n * Reloading nginx nginx                                                                                                                                     [ OK ] \n[Tue Dec 27 14:28:22 CST 2016] Reload success\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"还有一个步骤就是强制让虚拟主机跳转https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#还有一个步骤就是强制让虚拟主机跳转https"}},[s._v("#")]),s._v(" 还有一个步骤就是强制让虚拟主机跳转https")]),s._v(" "),a("p",[s._v("在虚拟主机里面添加")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server \n{  \n    listen 0.0.0.0:80;  \n    server_name www.dancefunk.com;\n    return 301 https://$server_name$request_uri;  \n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://ruby-china.org/topics/31983",target:"_blank",rel:"noopener noreferrer"}},[s._v("转自：使用 acme.sh 给 Nginx 安装 Let’ s Encrypt 提供的免费 SSL 证书"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"更新acme-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新acme-sh"}},[s._v("#")]),s._v(" 更新acme.sh")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("目前由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步.\n\n升级 acme.sh 到最新版 :\nacme.sh --upgrade\n\n如果你不想手动升级, 可以开启自动升级:\nacme.sh --upgrade --auto-upgrade\n\n之后, acme.sh 就会自动保持更新了.\n\n你也可以随时关闭自动更新:\nacme.sh --upgrade --auto-upgrade 0\n\n具体教程可以参考acme.sh的github\nhttps://github.com/Neilpang/acme.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"acme-sh-删除域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh-删除域名"}},[s._v("#")]),s._v(" acme.sh 删除域名")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("acme.sh --remove -d xxx.xxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("手动删除 /home/yxz/.acme.sh/xxx.xxx 文件夹。")]),s._v(" "),a("h2",{attrs:{id:"acme-sh的verify-error-invalid-response-from报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh的verify-error-invalid-response-from报错"}},[s._v("#")]),s._v(" acme.sh的Verify error:Invalid response from报错")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("打开虚拟主机配置文件 /vhost/xxxxx.conf 加入以下代码；")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("location ~ /.well-known/acme-challenge/ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    default_type "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/plain"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    root  /home/wwwroot/yoursite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \nlocation /.well-known/acme-challenge/ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# location ~ /\\.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     deny all;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# }")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("blockquote",[a("ul",[a("li",[s._v("重新加载nginx的配置")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/etc/init.d/nginx reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("ul",[a("li",[s._v("重新更新证书")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("acme.sh --renew -d www.yousite.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("续费证书成功")])]),s._v(" "),a("h2",{attrs:{id:"acme-sh申请错误的限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh申请错误的限制"}},[s._v("#")]),s._v(" acme.sh申请错误的限制")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Create new order error. Le_OrderFinalize not found. {\n  "type": "urn:ietf:params:acme:error:rateLimited",\n  "detail": "Error creating new order :: too many failed authorizations recently: see https://letsencrypt.org/docs/rate-limits/",\n  "status": 429\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("上面的信息代表的意思是有申请错误的限制，同一域名同一账号连续失败5次后会被暂停申请1个小时")]),a("br"),s._v(" "),a("strong",[s._v("这个就是频繁提交失败后被服务器暂停申请了，等1个小时再试就好了。")])])])}),[],!1,null,null,null);e.default=r.exports}}]);