(window.webpackJsonp=window.webpackJsonp||[]).push([[295],{859:function(s,n,e){"use strict";e.r(n);var a=e(5),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"控制器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#控制器"}},[s._v("#")]),s._v(" 控制器")]),s._v(" "),e("p",[s._v("ThinkPHP V5.0的控制器定义比较灵活，可以无需继承任何的基础类，也可以继承官方封装的"),e("code",[s._v("\\think\\Controller")]),s._v("类或者其他的控制器类。")]),s._v(" "),e("h3",{attrs:{id:"控制器定义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#控制器定义"}},[s._v("#")]),s._v(" 控制器定义")]),s._v(" "),e("blockquote",[e("ul",[e("li",[s._v("控制器的实际位置：application\\index\\controller\\Index.php")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace app\\index\\controller;\n\nclass Index \n{\n    public function index()\n    {\n        return 'index';\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("控制器类可以无需继承任何类，命名空间默认以"),e("code",[s._v("app")]),s._v("为根命名空间。")]),s._v(" "),e("p",[s._v("控制器的根命名空间可以设置，例如我们在应用配置文件中修改：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 修改应用类库命名空间\n'app_namespace' => 'application',\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("则实际的控制器类应该更改定义如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace application\\index\\controller;\n\nclass Index \n{\n    public function index()\n    {\n        return 'index';\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("如果继承了"),e("code",[s._v("think\\Controller")]),s._v("类的话，可以直接调用"),e("code",[s._v("think\\View")]),s._v("及"),e("code",[s._v("think\\Request")]),s._v("类的方法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace app\\index\\controller;\n\nuse think\\Controller;\n\nclass Index extends Controller\n{\n    public function index()\n    {\n        // 获取包含域名的完整URL地址\n        $this->assign('domain',$this->request->url(true));\n        return $this->fetch('index');\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"控制器初始化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#控制器初始化"}},[s._v("#")]),s._v(" 控制器初始化")]),s._v(" "),e("p",[s._v("如果你的控制器类继承了"),e("code",[s._v("\\think\\Controller")]),s._v("类的话，可以定义控制器初始化方法"),e("code",[s._v("_initialize")]),s._v("，在该控制器的方法调用之前首先执行。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace app\\index\\controller;\n\nuse think\\Controller;\n\nclass Index extends Controller\n{\n\n    public function _initialize()\n    {\n        echo 'init<br/>';\n    }\n    \n    public function hello()\n    {\n        return 'hello';\n    }\n    \n    public function data()\n    {\n        return 'data';\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[s._v("访问 "),e("code",[s._v("http://localhost/index.php/index/Index/hello")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("输出：\ninit\nhello\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"页面跳转"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页面跳转"}},[s._v("#")]),s._v(" 页面跳转")]),s._v(" "),e("p",[s._v("在应用开发中，经常会遇到一些带有提示信息的跳转页面，例如操作成功或者操作错误页面，并且自动跳转到另外一个目标页面。系统的"),e("code",[s._v("\\think\\Controller")]),s._v("类内置了两个跳转方法"),e("code",[s._v("success")]),s._v("和"),e("code",[s._v("error")]),s._v("，用于页面跳转提示。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace app\\index\\controller;\n\nuse think\\Controller;\nuse app\\index\\model\\User;\n\nclass Index extends Controller\n{\n    public function index()\n    {\n        $User = new User; //实例化User对象\n        $result = $User->save($data); \n        if($result){\n            //设置成功后跳转页面的地址，默认的返回页面是$_SERVER['HTTP_REFERER']\n            $this->success('新增成功', 'User/list');\n        } else {\n            //错误页面的默认跳转页面是返回前一页，通常不需要设置\n            $this->error('新增失败');\n        }\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[s._v("跳转地址是可选的，success方法的默认跳转地址是"),e("code",[s._v('$_SERVER["HTTP_REFERER"]')]),s._v("，"),e("code",[s._v("error")]),s._v("方法的默认跳转地址是"),e("code",[s._v("javascript:history.back(-1);")])]),s._v(" "),e("p",[e("code",[s._v("success")]),s._v("和"),e("code",[s._v("error")]),s._v("方法都可以对应的模板，默认的设置是两个方法对应的模板都是：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("THINK_PATH . 'tpl/dispatch_jump.tpl'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("我们可以改变默认的模板：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//默认错误跳转对应的模板文件\n'dispatch_error_tmpl' => APP_PATH . 'tpl/dispatch_jump.tpl',\n//默认成功跳转对应的模板文件\n'dispatch_success_tmpl' => APP_PATH . 'tpl/dispatch_jump.tpl',\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("也可以使用项目内部的模板文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//默认错误跳转对应的模板文件\n'dispatch_error_tmpl' => 'public/error',\n//默认成功跳转对应的模板文件\n'dispatch_success_tmpl' => 'public/success',\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("模板文件可以使用模板标签，并且可以使用下面的模板变量：")]),s._v(" "),e("h3",{attrs:{id:"重定向"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重定向"}},[s._v("#")]),s._v(" 重定向")]),s._v(" "),e("p",[e("code",[s._v("\\think\\Controller")]),s._v("类的"),e("code",[s._v("redirect")]),s._v("方法可以实现页面的重定向功能。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//重定向到News模块的Category操作\n$this->redirect('News/category', ['cate_id' => 2]);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("上面的用法是跳转到News模块的category操作，重定向后会改变当前的URL地址。")]),s._v(" "),e("p",[s._v("或者直接重定向到一个指定的外部URL地址，例如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//重定向到指定的URL地址 并且使用302\n$this->redirect('http://thinkphp.cn/blog/2',302);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("可以在重定向的时候通过session闪存数据传值，例如")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$this->redirect('News/category', ['cate_id' => 2], 302, ['data' => 'hello']);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用redirect助手函数还可以实现更多的功能，例如可以记住当前的URL后跳转")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("redirect('News/category')->remember();\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"空操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#空操作"}},[s._v("#")]),s._v(" 空操作")]),s._v(" "),e("p",[s._v("空操作是指系统在找不到指定的操作方法的时候，会定位到空操作（"),e("code",[s._v("_empty")]),s._v("）方法来执行，利用这个机制，我们可以实现错误页面和一些"),e("code",[s._v("URL")]),s._v("的优化。")]),s._v(" "),e("p",[s._v("例如，下面我们用空操作功能来实现一个城市切换的功能。"),e("br"),s._v("\n我们只需要给City控制器类定义一个_empty （空操作）方法：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<?php\nnamespace app\\index\\controller;\n\nclass City \n{\n    public function _empty($name)\n    {\n        //把所有城市的操作解析到city方法\n        return $this->showCity($name);\n    }\n    \n    //注意 showCity方法 本身是 protected 方法\n    protected function showCity($name)\n    {\n        //和$name这个城市相关的处理\n         return '当前城市' . $name;\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("接下来，我们就可以在浏览器里面输入")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://serverName/index/city/beijing/\nhttp://serverName/index/city/shanghai/\nhttp://serverName/index/city/shenzhen/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("由于City并没有定义"),e("code",[s._v("beijing")]),s._v("、"),e("code",[s._v("shanghai")]),s._v("或者"),e("code",[s._v("shenzhen")]),s._v("操作方法，因此系统会定位到空操作方法 "),e("code",[s._v("_empty")]),s._v("中去解析，"),e("code",[s._v("_empty")]),s._v("方法的参数就是当前URL里面的操作名，因此会看到依次输出的结果是：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("当前城市:beijing\n当前城市:shanghai\n当前城市:shenzhen\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);