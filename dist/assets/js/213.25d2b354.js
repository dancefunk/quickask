(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{759:function(s,n,e){"use strict";e.r(n);var t=e(5),a=Object(t.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"redux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redux"}},[s._v("#")]),s._v(" Redux")]),s._v(" "),e("p",[s._v("如果要对redux有一个非常详细的认识，推荐阅读"),e("a",{attrs:{href:"http://cn.redux.js.org/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("中文文档"),e("OutboundLink")],1),s._v("，写的非常详细。读了这个教程，有一个非常深刻的感觉，redux并没有任何魔法。但是对第一次接触状态管理框架的童鞋来说可能有一些概念难以接受，但是随着慢慢试用就会理解了，不要被"),e("code",[s._v("reducers，middleware，store")]),s._v("吓到了，其实它们就字面意思不容易理解而已。")]),s._v(" "),e("h3",{attrs:{id:"核心概念-来自redux中文文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心概念-来自redux中文文档"}},[s._v("#")]),s._v(" 核心概念（来自Redux中文文档）")]),s._v(" "),e("p",[s._v("一个应用会有一个"),e("code",[s._v("state")]),s._v("，它通常是一个普通对象，例如一个"),e("code",[s._v("todo")]),s._v("应用的"),e("code",[s._v("state")]),s._v("可能是这样的：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("{\n\ttodos: [\n    \t{ text: 'Eat Food', completed: true },\n        { text: 'Run', completed: false }\n    ],\n    visibilityFilter: 'show_all'\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("这个对象就像是"),e("code",[s._v("'Model'")]),s._v("，区别是它并没有 "),e("code",[s._v("setter（修改器方法）")]),s._v("。因此其它的代码不能随意修改它，造成难以修复的 "),e("code",[s._v("bug")]),s._v("。\n想要更新"),e("code",[s._v("state")]),s._v("中的数据，你需要发起一个"),e("code",[s._v("action")]),s._v("。"),e("code",[s._v("Action（动作）")]),s._v("就是一个普通的"),e("code",[s._v("JavaScript对象")]),s._v("，这个对象用来描述发生了什么事情。例如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("{ type: 'ADD_TODO', text: 'Go to swimming pool' } // 添加一个todo事项，内容是去游泳池。\n{ type: 'TOGGLE_TODO', index: 1} // 切换需要完成的todo。\n{ type: 'SET_VISIBILITY_FILTER', filter: 'SHOW_ALL' } // 设置过滤条件。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("强制使用 "),e("code",[s._v("action")]),s._v(" 来描述所有变化带来的好处是可以清晰地知道应用中到底发生了什么。如果一些东西改变了，就可以知道为什么变。"),e("code",[s._v("action")]),s._v(" 就像是描述发生了什么的面包屑。最终，"),e("strong",[s._v("为了把 "),e("code",[s._v("action")]),s._v(" 和 "),e("code",[s._v("state")]),s._v(" 串起来"),e("code",[s._v("（通过action改变state）")]),s._v("，开发一些函数，这就是 "),e("code",[s._v("reducer")]),s._v("。再次地，没有任何魔法，"),e("code",[s._v("reducer")]),s._v(" 只是一个接收 "),e("code",[s._v("state")]),s._v(" 和 "),e("code",[s._v("action")]),s._v("，并返回新的 "),e("code",[s._v("state")]),s._v(" 的函数。")]),s._v(" 对于大的应用来说，可能很难开发这样的函数，所以我们编写很多小函数来分别管理 "),e("code",[s._v("state")]),s._v(" 的一部分：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function visibilityFilter(state = 'SHOW_ALL', action) {\n\t// 通过判断 Action 的 类型操作 state \n\tif (action.type === 'SET_VISIBILITY_FILTER') {\n    \treturn action.filter\n    } else {\n    \treturn state\n    }\n}\n\nfunction todos(state = [], action) {\n\tswitch(action.type) {\n    \tcase 'ADD_TODO': return state.concat([{ text: action.text, completed: false }])\n        case 'TOGGLE_TODO': return state.map((todo, index) => {\n        \taction.index === index ? { text: todo.text, completed: !todo.completed } : todo\n        })\n        default: return state\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("最后用一个reducer管理所有的小reducer，进而来管理整个应用的"),e("code",[s._v("state")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function todoApp(state = {}, action) {\n\treturn {\n    \ttodos: todos(state.todos, action),\n        visibilityFilter: visibilityFilter(state.visibilityFilter, action)\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("这差不多就是 "),e("code",[s._v("Redux")]),s._v(" 思想的全部。注意到没我们还没有使用任何 "),e("code",[s._v("Redux")]),s._v(" 的 "),e("code",[s._v("API")]),s._v("。"),e("code",[s._v("Redux")]),s._v(" 里有一些工具来简化这种模式，但是主要的想法是如何根据这些 "),e("code",[s._v("action")]),s._v(" 对象来更新 "),e("code",[s._v("state")]),s._v("，而且 "),e("code",[s._v("90%")]),s._v(" 的代码都是纯 "),e("code",[s._v("JavaScript")]),s._v("，没用 "),e("code",[s._v("Redux、Redux API")]),s._v(" 和其它魔法。")]),s._v(" "),e("h3",{attrs:{id:"三大原则-单一数据源、state是只读的、使用纯函数来执行修改任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三大原则-单一数据源、state是只读的、使用纯函数来执行修改任务"}},[s._v("#")]),s._v(" 三大原则：单一数据源、State是只读的、使用纯函数来执行修改任务")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1、单一数据源\n整个应用的state被储存在一棵object tree中，并且这个object tree只存在于唯一一个store中。\n\n\n2、State 是只读的\n唯一改变state的办法就是触发一个action，action是一个用于描述已发生事件的普通对象。\n这样确保了视图和网络请求都不能直接修改 state，相反它们只能表达想要修改的意图。\n因为所有的修改都被集中化处理，且严格按照一个接一个的顺序执行，因此不用担心 race condition 的出现。\nAction 就是普通对象而已，因此它们可以被日志打印、序列化、储存、后期调试或测试时回放出来。\n\n\n3、使用纯函数来执行修改\n为了描述 action 如何改变 state tree ，你需要编写 reducers。\nReducer 只是一些纯函数，它接收先前的 state 和 action，并返回新的 state。\n刚开始你可以只有一个 reducer，随着应用变大，你可以把它拆成多个小的 reducers，分别独立地操作 state tree 的不同部分。\n因为 reducer 只是函数，你可以控制它们被调用的顺序，传入附加数据，甚至编写可复用的 reducer 来处理一些通用任务，如分页器。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"安装redux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装redux"}},[s._v("#")]),s._v(" 安装redux")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install --save redux\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd src\nmkdir redux\ncd redux\nmkdir actions // 创建一个放action的目录\nmkdir reducers // 创建一个放reducer的目录\ntouch reducers.js // 合并所有reducer，管理一个个reducer\ntouch store.js // 管理整个redux的仓库\ntouch actions/counter.js // 创建一个action\ntouch reducers/counter.js // 创建一个reducer\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("已经建好了基础目录，下一个环节来创建一个action。")]),s._v(" "),e("p",[s._v("不过在此之前，既然已经建好了目录，顺便把路径别名给改了：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  // 静态文件服务器配置\n  devServer: {\n  \t// ... 省略devServer配置代码\n  },\n  resolve: {\n    alias: {\n      '@': resolve('src'),\n      // ...省略一些代码\n      actions: resolve('src/redux/actions'),\n      reducers: resolve('src/redux/reducers')\n    }\n  }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"action"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#action"}},[s._v("#")]),s._v(" action")]),s._v(" "),e("p",[s._v("定义：\nAction 是把数据从应用（译者注：这里之所以不叫 view 是因为这些数据有可能是服务器响应，用户输入或其它非 view 的数据 ）传到 "),e("code",[s._v("store")]),s._v(" 的有效载荷。它是 "),e("code",[s._v("store")]),s._v(" 数据的唯一来源。一般来说你会通过 "),e("code",[s._v("store.dispatch()")]),s._v(" 将 "),e("code",[s._v("action")]),s._v(" 传到 "),e("code",[s._v("store")]),s._v("。")]),s._v(" "),e("p",[s._v("添加新的"),e("code",[s._v("todo")]),s._v("任务的"),e("code",[s._v("action")]),s._v("是这样的：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 动作的常量名字\nconst ADD_TODO = 'ADD_TODO'\n\n// 一个Action 对象\n{\n\ttype: ADD_TODO, // 对应常量名字\n    text: 'Build my first Redux App' // 除了 type 字段外，action 对象的结构完全由你自己决定。\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("上面是一个"),e("code",[s._v("Action对象")]),s._v("，描述动作的对象，还有一个概念叫"),e("code",[s._v("Action")]),s._v("创建函数，两者不同，别混淆。")]),s._v(" "),e("p",[s._v("先来写"),e("code",[s._v("action")]),s._v("创建函数。通过"),e("code",[s._v("action")]),s._v("创建函数，就可以创建一个"),e("code",[s._v("action~")])]),s._v(" "),e("blockquote",[e("p",[s._v("src/redux/actions/counter.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('/* action */\n\nexport const INCREMENT = "counter/INCREMENT" // 只要保证reducer判断和这里定义的保持一致就可以。\nexport const DECREMENT = "counter/DECREMENT" // 这里可以随便定义。\nexport const RESET = "counter/RESET" // 例如 a / b / c\nexport const ADD_TODO = "ADD_TODO"\n\nexport function increment() {\n\t// 创建一个Action(下同)，除了 type 字段外，action 对象的结构完全由你自己决定。\n\treturn { type: INCREMENT }\n}\n\nexport function decrement() {\n\treturn { type: DECREMENT }\n}\n\nexport function reset() {\n\treturn { type: RESET }\n}\n\nexport function addTodo(text) {\n\treturn {\n    \ttype: ADD_TODO,\n        text\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("p",[s._v("在调用"),e("code",[s._v("action")]),s._v("创建函数时，需要手动触发一个"),e("code",[s._v("dispatch")]),s._v("，像这样：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function addTodoWithDispatch(text) {\n\tconst action = {\n    \ttype: ADD_TODO,\n        text\n    }\n    dispatch(action)\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("不同的是，"),e("code",[s._v("Redux")]),s._v(" 中只需把 "),e("code",[s._v("action")]),s._v(" 创建函数返回的action对象传给 "),e("code",[s._v("dispatch()")]),s._v(" 方法即可发起一次 "),e("code",[s._v("dispatch")]),s._v(" 过程：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("dispatch(increment())\ndispatch(addTodo(text))\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("或者创建一个 被绑定的 "),e("code",[s._v("action")]),s._v(" 创建函数 来自动 "),e("code",[s._v("dispatch：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const boundIncrement = () => dispatch(increment())\nconst boundAddTodo = text => dispatch(addTodo(text))\n\n// 然后需要调用它们：\nboundIncrement()\nboundAddTodo(text)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"reducers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#reducers"}},[s._v("#")]),s._v(" Reducers")]),s._v(" "),e("p",[e("code",[s._v("Reducers")]),s._v(" 指定了应用状态的变化如何响应 "),e("code",[s._v("actions")]),s._v(" 并发送到 "),e("code",[s._v("store")]),s._v(" 的，记住 "),e("code",[s._v("actions")]),s._v(" 只是描述了有事情发生了这一事实，并没有描述应用如何更新 "),e("code",[s._v("state")]),s._v("。\n注意："),e("code",[s._v("reducer")]),s._v("是一个纯函数，接受"),e("code",[s._v("action")]),s._v("和旧的"),e("code",[s._v("state")]),s._v("，生成新的"),e("code",[s._v("state")]),s._v("。")]),s._v(" "),e("blockquote",[e("p",[s._v("src/redux/reducers/counter.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/* 引用actions里定义的action常量 */\nimport { INCREMENT, DECREMENT, RESET } from 'actions/counter'\n\n/* 初始化state */\nconst initState = { count: 0 }\n\n/*\n *reducer\n *reducer就是纯函数，接收state 和 action，然后返回一个新的 state\n */\nexport default function reducer(state = initState, action) {\n\tswitch (action.type) {\n    \tcase INCREMENT: return { count: state.count + 1 }\n        case DECREMENT: return { count: state.count - 1 }\n        case RESET: return { count: 0 }\n        default : return state\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("一个项目可以有很多个"),e("code",[s._v("reducer")]),s._v("，我们把它们统一管理。")]),s._v(" "),e("blockquote",[e("p",[s._v("src/redux/reducers.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import counter from './reducers/counter'\n\n// reducer就是纯函数，接收state 和 action，然后返回一个新的 state\nexport default function combineReducers(state = {}, action) {\n  return {\n    counter: counter(state.counter, action)\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("code",[s._v("reducer")]),s._v("就是纯函数，接收"),e("code",[s._v("state")]),s._v(" 和 "),e("code",[s._v("action")]),s._v("，然后返回一个新的 "),e("code",[s._v("state")]),s._v("。")]),s._v(" "),e("p",[s._v("看看上面的代码，无论是"),e("code",[s._v("combineReducers")]),s._v("函数也好，还是"),e("code",[s._v("reducer")]),s._v("函数也好（函数名可以不写），都是接收"),e("code",[s._v("state")]),s._v("和"),e("code",[s._v("action")]),s._v("，都是返回更新后的"),e("code",[s._v("state")]),s._v("。区别就是"),e("code",[s._v("combineReducers")]),s._v("函数是处理整棵树，"),e("code",[s._v("reducer")]),s._v("函数是处理树的某一点。")]),s._v(" "),e("p",[s._v("接下来，我们要创建一个"),e("code",[s._v("store")]),s._v("，"),e("code",[s._v("store")]),s._v("需要一个单一的"),e("code",[s._v("reducers")]),s._v("，"),e("code",[s._v("reducers")]),s._v("包含散落在整个应用中所有的"),e("code",[s._v("reducer")]),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"store"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#store"}},[s._v("#")]),s._v(" store")]),s._v(" "),e("p",[s._v("前面我们可以使用"),e("code",[s._v("action")]),s._v('对象来描述"发生了什么"，使用'),e("code",[s._v("action")]),s._v("创建函数来返回一个"),e("code",[s._v("action")]),s._v("对象。")]),s._v(" "),e("p",[s._v("还可以使用"),e("code",[s._v("reducers")]),s._v("来根据"),e("code",[s._v("action")]),s._v("更新"),e("code",[s._v("state")]),s._v("。")]),s._v(" "),e("p",[s._v("那我们怎么提交一个"),e("code",[s._v("action")]),s._v("对象来触发"),e("code",[s._v("reducers")]),s._v("更新"),e("code",[s._v("state")]),s._v("呢？")]),s._v(" "),e("p",[e("code",[s._v("store")]),s._v("就是把它们联系到一起的对象。"),e("code",[s._v("store")]),s._v("有以下职责：")]),s._v(" "),e("ul",[e("li",[s._v("维持应用的"),e("code",[s._v("state")])]),s._v(" "),e("li",[s._v("提供"),e("code",[s._v("getState()")]),s._v("方法获取"),e("code",[s._v("state")])]),s._v(" "),e("li",[s._v("提供"),e("code",[s._v("dispatch(action)")]),s._v("触发"),e("code",[s._v("reducers")]),s._v("方法更新"),e("code",[s._v("state")]),s._v("（这就是主要修改"),e("code",[s._v("state")]),s._v("的方法）")]),s._v(" "),e("li",[s._v("通过"),e("code",[s._v("subscribe(listener)")]),s._v("注册监听器")]),s._v(" "),e("li",[s._v("通过"),e("code",[s._v("subscribe(listener)")]),s._v("返回的函数注销监听器")])]),s._v(" "),e("blockquote",[e("p",[s._v("src/redux/store.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { createStore } from 'redux'\nimport combineReducers from './reducers.js'\n\n// createStore需要一个对象来初始化store： let store = createStore(combineReducers)\nexport default createStore(combineReducers)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("到目前为止，我们已经创建了一个redux了~\n接下来就是使用了：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd src\ncd redux\ntouch testRedux.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("src/redux/testRedux.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import {increment, decrement, reset} from './actions/counter';\n\nimport store from './store';\n\n// 打印初始状态\nconsole.log(store.getState());\n\n// 每次 state 更新时，打印日志\n// 注意 subscribe() 返回一个函数用来注销监听器\nlet unsubscribe = store.subscribe(() =>\n    console.log(store.getState())\n);\n\n// 发起一系列 action\nstore.dispatch(increment());\nstore.dispatch(decrement());\nstore.dispatch(reset());\n\n// 停止监听 state 更新\nunsubscribe();\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[s._v("当前文件夹执行命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("webpack testRedux.js build.js\nnode build.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("是不是看到输出了state变化？")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("{ counter: { count: 0 } }\n{ counter: { count: 1 } }\n{ counter: { count: 0 } }\n{ counter: { count: 0 } }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("做这个测试，就是为了告诉大家，redux和react没关系，虽说他俩能合作。")]),s._v(" "),e("p",[s._v("到这里,建议再理下redux的数据流，看看"),e("a",{attrs:{href:"http://cn.redux.js.org/docs/basics/DataFlow.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"react-redux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#react-redux"}},[s._v("#")]),s._v(" react-redux")]),s._v(" "),e("p",[s._v("先添加一个"),e("code",[s._v("Counter")]),s._v("页面。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd src/pages\nmkdir Counter\ntouch Counter/Counter.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("src/pages/Counter/Counter.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import React, { Component } from 'react'\n\nexport default class Counter extends Component {\n\trender() {\n\t\treturn (\n        \t<div>\n            \t<div>当前计数为(显示redux计数)</div>\n                <button onClick={() => { console.log('调用自增函数') }}>自增</button>\n                <button onClick={() => { console.log('调用自减函数') }}>自减</button>\n                <button onClick={() => { console.log('调用重置函数') }}>重置</button>\n            </div>\n        )\n\t}\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("修改路由，增加"),e("code",[s._v("Counter")])]),s._v(" "),e("blockquote",[e("p",[s._v("src/router/router.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import React from \'react\'\nimport { BrowserRouter as Router, Route, Switch, Link } from \'react-router-dom\'\n\nimport Home from \'pages/Home/Home\'\nimport Page from \'pages/Page/Page\'\nimport Counter from \'pages/Counter/Counter\'\n\nexport default () => (\n    <Router>\n    \t<div>\n        \t<ul>\n            \t<li><Link to="/">首页</Link></li>\n            \t<li><Link to="/page">Page</Link></li>\n                <li><Link to="/counter">Counter</Link></li>\n            </ul>\n            <Switch>\n            \t<Route exact path="/" component={Home} />\n            \t<Route path="/page" component={Page} />\n                <Route path="/counter" component={Counter}/>\n            </Switch>\n        </div>\n    </Router>\n\t// 相当于return 一个（组件）\n)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("p",[s._v("现在点击按钮呢，调用的是"),e("code",[s._v("console.log")]),s._v("函数，下一步我们让"),e("code",[s._v("Counter")]),s._v("组件和"),e("code",[s._v("Redux")]),s._v("联合起来，使"),e("code",[s._v("Counter")]),s._v("能获得到"),e("code",[s._v("Redux")]),s._v("的"),e("code",[s._v("state")]),s._v("，并且能发射"),e("code",[s._v("action")]),s._v("。")]),s._v(" "),e("p",[s._v("我们可以使用上一节用到的"),e("code",[s._v("testRedux")]),s._v("的方法使用"),e("code",[s._v("store.subscribe")]),s._v("手动监听~手动引入"),e("code",[s._v("store")]),s._v("，但这样是很繁琐的，所以"),e("code",[s._v("react-redux")]),s._v("提供了一个方法"),e("code",[s._v("connect")]),s._v("，下面是这个方法的介绍：")]),s._v(" "),e("blockquote",[e("p",[s._v("容器组件就是使用 store.subscribe() 从 Redux state 树中读取部分数据，并通过 props 来把这些数据提供给要渲染的组件。你可以手工来开发容器组件，但建议使用 React Redux 库的 connect() 方法来生成，这个方法做了性能优化来避免很多不必要的重复渲染。")])]),s._v(" "),e("p",[e("code",[s._v("connect")]),s._v("接受两个参数，一个"),e("code",[s._v("mapStateToProps")]),s._v("，就是把"),e("code",[s._v("redux")]),s._v("的"),e("code",[s._v("state")]),s._v("转为组件的"),e("code",[s._v("Props")]),s._v("，还有一个参数是"),e("code",[s._v("mapDispatchToProps")]),s._v("，就是把发射"),e("code",[s._v("action")]),s._v("的方法转为"),e("code",[s._v("Props")]),s._v("的属性函数。")]),s._v(" "),e("h4",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install --save react-redux\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后修改原来的"),e("code",[s._v("Counter")]),s._v("组件：")]),s._v(" "),e("blockquote",[e("p",[s._v("src/pages/Counter/Counter.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import React, { Component } from 'react'\nimport { increment, decrement, reset } from 'actions/counter'\n\nimport { connect } from 'react-redux'\n\n// 先写connect的两个参数函数：\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tcounter: state.counter\n\t}\n}\n\nconst mapDispatchToProps = (dispatch) => {\n\treturn {\n    \tincrement() {\n        \tdispatch(increment())\n        },\n        decrement() {\n        \tdispatch(decrement())\n        },\n        reset() {\n        \tdispatch(reset())\n        }\n    }\n}\n\n// 不要默认导出Counter，删掉export default\nclass Counter extends Component {\n    // 通过connect 这里可以直接拿到this.props\n\trender() {\n\t\treturn (\n        \t<div>\n            \t<div>当前计数为{this.props.counter.count}</div>\n                <button onClick={() => this.props.increment() }>自增</button>\n                <button onClick={() => this.props.decrement() }>自减</button>\n                <button onClick={() => this.props.reset() }>重置</button>\n            </div>\n        )\n\t}\n}\n\n// 最后导出用connect 处理后的Counter。\nexport default connect(mapStateToProps, mapDispatchToProps)(Counter)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br")])]),e("p",[s._v("接下来我们要把"),e("code",[s._v("store")]),s._v("，要让所有的容器组件都可以访问到"),e("code",[s._v("Redux store")]),s._v("，一种方式是把它以"),e("code",[s._v("props")]),s._v("的形式传入到所有容器组建中。但这样太麻烦了，因为必须要用"),e("code",[s._v("store")]),s._v("把展示组件包裹一层，仅仅是因为恰好在组件树中渲染一个容器组件。")]),s._v(" "),e("p",[s._v("建议的方式是：使用指定的"),e("code",[s._v("React Redux")]),s._v("组件 来 魔法般的 让所有的容器组件都可以访问"),e("code",[s._v("store")]),s._v("，而不必显示地传递它。")]),s._v(" "),e("h3",{attrs:{id:"provider"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#provider"}},[s._v("#")]),s._v(" Provider")]),s._v(" "),e("p",[s._v("要让所有的容器组件都可以访问到"),e("code",[s._v("store")]),s._v("，把它注入到根组件是再好不过的事情了。")]),s._v(" "),e("blockquote",[e("p",[s._v("src/index.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { Provider } from 'react-redux'\n\nimport store from './redux/store'\nimport Router from 'router/router'\n\nReactDOM.render(\n\t<Provider store={store}>\n    \t<Router />\n    </Provider>,\n    document.getElementById('app')\n)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"总结一下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结一下"}},[s._v("#")]),s._v(" 总结一下")]),s._v(" "),e("p",[e("code",[s._v("Provider")]),s._v("组件是让所有的组件都可以访问到"),e("code",[s._v("store")]),s._v("的容器组件，用这个组件可以使我们不需要调用"),e("code",[s._v("store.subscribe")]),s._v("手动监听，也不需要我们显示地传递"),e("code",[s._v("store")]),s._v("。")]),s._v(" "),e("p",[e("code",[s._v("connect")]),s._v("函数作用是从"),e("code",[s._v("Redux")]),s._v(" "),e("code",[s._v("state")]),s._v("树中读取部分数据，并把这些部分数据通过"),e("code",[s._v("props")]),s._v("的形式传递给要渲染的组件，同时也传递"),e("code",[s._v("dispatch(action)")]),s._v("函数到"),e("code",[s._v("props")]),s._v("。\n（当然可以只传"),e("code",[s._v("mapStateToProps")]),s._v("，因为这是"),e("code",[s._v("connect")]),s._v("的第一个参数，所以要传"),e("code",[s._v("mapDispatchToProps")]),s._v("的话必须要有"),e("code",[s._v("mapStateToProps")]),s._v("）。")]),s._v(" "),e("p",[s._v("接下来，我们要说一下异步的"),e("code",[s._v("action")]),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"异步action"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#异步action"}},[s._v("#")]),s._v(" 异步action")]),s._v(" "),e("p",[s._v("参考地址： "),e("a",{attrs:{href:"http://cn.redux.js.org/docs/advanced/AsyncActions.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://cn.redux.js.org/docs/advanced/AsyncActions.html"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("想象一下我们调用一个异步get请求去后台请求数据：")]),s._v(" "),e("ul",[e("li",[s._v("1.请求开始的时候，界面转圈提示正在加载。"),e("code",[s._v("isLoading")]),s._v("置为"),e("code",[s._v("true")]),s._v("。")]),s._v(" "),e("li",[s._v("2.请求成功，显示数据。"),e("code",[s._v("isLoading")]),s._v("置为"),e("code",[s._v("false")]),s._v("，"),e("code",[s._v("data")]),s._v("填充数据 。")]),s._v(" "),e("li",[s._v("3.请求失败，显示失败。"),e("code",[s._v("isLoading")]),s._v("置为"),e("code",[s._v("false")]),s._v("， 显示错误信息 。")])]),s._v(" "),e("p",[s._v("下面，我们以向后台请求用户基本信息为例：")]),s._v(" "),e("p",[s._v("1、我们先创建一个"),e("code",[s._v("user.json")]),s._v("，当客户端请求这个文件时，相当于后台的API接口。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd dist\nmkdir api\ncd api\ntouch user.json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[s._v("dist/api/user.json")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n\t"name": "Zep",\n    "intro": "please give me a star"\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("2、创建必须的"),e("code",[s._v("action")]),s._v("创建函数。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd src/redux/actions\ntouch userInfo.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("src/redux/actions/userInfo.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('export const GET_USER_INFO_REQUEST = "userInfo/GET_USER_INFO_REQUEST"\nexport const GET_USER_INFO_SUCCESS = "userInfo/GET_USER_INFO_SUCCESS"\nexport const GET_USER_INFO_FAIL = "userInfo/GET_USER_INFO_FAIL"\n\n// 请求中\nfunction getUserInfoRequest() {\n    return {\n        type: GET_USER_INFO_REQUEST\n    }\n}\n\n// 请求成功\nfunction getUserInfoSuccess(userInfo) {\n    return {\n        type: GET_USER_INFO_SUCCESS,\n        userInfo: userInfo\n    }\n}\n\n// 请求失败\nfunction getUserInfoFail() {\n    return {\n        type: GET_USER_INFO_FAIL\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("我们创建了"),e("code",[s._v("请求中")]),s._v("，"),e("code",[s._v("请求成功")]),s._v("，"),e("code",[s._v("请求失败")]),s._v("三个"),e("code",[s._v("action")]),s._v("创建函数。")]),s._v(" "),e("p",[s._v("3、创建reducer。")]),s._v(" "),e("p",[s._v("再强调一次，"),e("code",[s._v("reducer")]),s._v("是根据"),e("code",[s._v("state")]),s._v("和"),e("code",[s._v("action")]),s._v("生成新的"),e("code",[s._v("state")]),s._v("的纯函数。")]),s._v(" "),e("blockquote",[e("p",[s._v("src/redux/reducers/userInfo.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import {\n  GET_USER_INFO_REQUEST,\n  GET_USER_INFO_SUCCESS,\n  GET_USER_INFO_FAIL\n} from 'actions/userInfo'\n\nconst initState = {\n  isLoading: false,\n  userInfo: {},\n  errorMsg: ''\n}\n\nexport default function reducer(state = initState, action) {\n  switch (action.type) {\n    case GET_USER_INFO_REQUEST:\n      return {\n        ...state,\n        isLoading: true,\n        userInfo: {},\n        errorMsg: ''\n      }\n    case GET_USER_INFO_SUCCESS:\n      return {\n        ...state,\n        isLoading: false,\n        userInfo: action.userInfo,\n        errorMsg: ''\n      }\n    case GET_USER_INFO_FAIL:\n      return {\n        ...state,\n        isLoading: false,\n        userInfo: {},\n        errorMsg: '请求错误'\n      }\n    default: return state\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br")])]),e("p",[e("strong",[s._v("这里的"),e("code",[s._v("...state语法")]),s._v("，是和别人的"),e("code",[s._v("Object.assign()")]),s._v("起同一个作用，合并新旧"),e("code",[s._v("state")]),s._v("。")])]),s._v(" "),e("p",[s._v("更新"),e("code",[s._v("src/redux/reducer.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import counter from 'reducers/counter'\nimport userInfo from 'reducers/userInfo'\n\nexport default funtion combineReducers(state = {}, action) {\n\treturn {\n    \tcounter: counter(state.counter, action),\n        userInfo: userInfo(state.userInfo,action)\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("4、现在有了"),e("code",[s._v("action")]),s._v("，有了"),e("code",[s._v("reducer")]),s._v("，我们就需要调用把"),e("code",[s._v("action")]),s._v("里面的三个"),e("code",[s._v("action")]),s._v("函数和网络请求结合起来。")]),s._v(" "),e("ul",[e("li",[s._v("请求中 dispatch getUserInfoRequest")]),s._v(" "),e("li",[s._v("请求成功 dispatch getUserInfoSuccess")]),s._v(" "),e("li",[s._v("请求失败 dispatch getUserInfoFail")])]),s._v(" "),e("p",[e("code",[s._v("src/redux/actions/userInfo.js")]),s._v("添加：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// ... 前面代码省略\n\n// 请求中\nfunction getUserInfoRequest() {\n    return {\n        type: GET_USER_INFO_REQUEST\n    }\n}\n\n// 请求成功\nfunction getUserInfoSuccess(userInfo) {\n    return {\n        type: GET_USER_INFO_SUCCESS,\n        userInfo: userInfo\n    }\n}\n\n// 请求失败\nfunction getUserInfoFail() {\n    return {\n        type: GET_USER_INFO_FAIL\n    }\n}\n\nexport function getUserInfo() {\n\treturn function (dispatch) {\n    \tdispatch(getUserInfoRequest())\n        // 这里并没有安装fetch包，使用的是MDN规范API，路径根据项目可能稍有不同\n        return fetch('http://10.10.100.217:10088/api/userInfo.json')\n        \t.then((res) => {\n            \treturn res.json()\n            })\n            .then((json) => {\n            \tdispatch(getUserInfoSuccess(json)\n            }).catch(() => {\n            \tdispatch(getUserInfoFail())\n            })\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br")])]),e("p",[s._v("它告诉你"),e("code",[s._v("action")]),s._v("创建函数返回的必须是普通的"),e("code",[s._v("action对象")]),s._v("，不过它也提示了我们应该使用中间件处理这类"),e("code",[s._v("actions")]),s._v("。")]),s._v(" "),e("p",[s._v("所以我们为了让"),e("code",[s._v("action")]),s._v("创建函数除了返回"),e("code",[s._v("action对象")]),s._v("外，还可以返回函数，我们需要引用"),e("code",[s._v("redux-thunk")]),s._v("。")]),s._v(" "),e("p",[e("code",[s._v("npm install --save redux-thunk")])]),s._v(" "),e("p",[s._v("这里涉及到"),e("code",[s._v("redux")]),s._v("中间件"),e("code",[s._v("middleware")]),s._v("，简单地说，中间件就是"),e("code",[s._v("action")]),s._v("在到达"),e("code",[s._v("reducer")]),s._v("（处理state发生变化的地方）之前，先经过中间件处理，我们之前知道"),e("code",[s._v("reducer")]),s._v("能处理的"),e("code",[s._v("action")]),s._v("只能是普通对象包含一个必须字段"),e("code",[s._v("type")]),s._v("的普通对象，所以我们使用中间件来处理函数形式的"),e("code",[s._v("action")]),s._v("，把它们转为标准的"),e("code",[s._v("action")]),s._v("给"),e("code",[s._v("reducer")]),s._v("，这就是"),e("code",[s._v("redux-thunk")]),s._v("的作用。\n下面来使用"),e("code",[s._v("redux-thunk")]),s._v("中间件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/* store.js */\n\nimport { createStore, applyMiddleware } from 'redux'\nimport thunkMiddleware from 'redux-thunk'\n\nimport combineReducers from './reducers'\n\nexport default createStore(combineReducers, applyMiddleware(thunkMiddleware))\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("这样就OK了~加一个路由页面试一下。")]),s._v(" "),e("blockquote",[e("p",[s._v("src/pages/UserInfo/UserInfo.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport { getUserInfo } from 'actions/userInfo'\n\nclass UserInfo extends Component {\n\trender() {\n    \tconst { userInfo, isLoading, errorMsg } = this.props.userInfo\n        // 根据 redux state isLoading 切换状态\n        return (\n        \t<div>\n            \t{\n                \tisLoading ? '请求中...' :\n                    (errorMsg ? errorMsg : \n                    \t<div>\n                        \t<p>用户信息：</p>\n                            <p>用户名：{ userInfo.name }</p>\n                            <p>介绍： { userInfo.intro }</p>\n                        </div>\n                    )\n                }\n                <button onClick={ () => this.props.getUserInfo() }>请求用户信息</button>\n            </div>\n        )\n    }\n}\n\nexport default connect( (state) => ({userInfo: state.userInfo}), {getUserInfo})(UserInfo)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("p",[s._v("这里你可能发现"),e("code",[s._v("connect")]),s._v("参数的写法不一样了，"),e("code",[s._v("mapStateToProps")]),s._v("函数用了"),e("code",[s._v("es6")]),s._v("的简写"),e("code",[s._v("()")]),s._v("里的东西会默认被"),e("code",[s._v("return")]),s._v("出去，"),e("code",[s._v("mapDispatchToProps")]),s._v("用了"),e("code",[s._v("react-redux")]),s._v("提供的简单写法。")]),s._v(" "),e("blockquote",[e("p",[s._v("增加路由src/router/router.js：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import React from \'react\'\nimport { BrowserRouter as Router, Route, Switch, Link } from \'react-router-dom\'\n\nimport Home from \'pages/Home/Home\'\nimport Page from \'pages/Page/Page\'\nimport Counter from \'pages/Counter/Counter\'\n\n\nexport default () => (\n    <Router>\n    \t<div>\n        \t<ul>\n            \t<li><Link to="/">首页</Link></li>\n            \t<li><Link to="/page">Page</Link></li>\n                <li><Link to="/counter">Counter</Link></li>\n                <li><Link to="/userinfo">UserInfo</Link></li>\n            </ul>\n            <Switch>\n            \t<Route exact path="/" component={Home} />\n            \t<Route path="/page" component={Page} />\n                <Route path="/counter" component={Counter}/>\n                <Route path="/userinfo" component={UserInfo}/>\n            </Switch>\n        </div>\n    </Router>\n\t// 相当于return 一个（组件）\n)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("p",[s._v("现在可以执行"),e("code",[s._v("npm run dev")]),s._v("看效果了~（如果请求路径错了或者跨域问题请求失败了，都会提示"),e("code",[s._v("reducer")]),s._v("里定义的请求错误信息）。")])])}),[],!1,null,null,null);n.default=a.exports}}]);